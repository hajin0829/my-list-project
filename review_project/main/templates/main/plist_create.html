{% extends "main/base.html" %}

{% block title %}P-List 만들기{% endblock %}

{% block content %}
<h2>P-List 만들기</h2>

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <label>리스트 이름</label><br>
    <input type="text" name="title" required>



    <br><br><label>대표 사진 업로드</label><br>
    <input type="file" name="cover_image" accept="image/*"><br><br>

    <img id="coverPreview" style="display:none; width:200px; border-radius:10px;">

    <script>
    document.getElementById('coverInput').addEventListener('change', function(event) {
        const img = document.getElementById('coverPreview');
        const file = event.target.files[0];

        if (file) {
            img.src = URL.createObjectURL(file);
            img.style.display = 'block';
        } else {
            img.style.display = 'none';
        }
    });
    </script>


    <!-- 검색창 -->
    <label>리뷰 검색</label><br>
    <input type="text" id="reviewSearch" placeholder="리뷰 검색...">
    <br><br>

    <!-- 리뷰 선택: 딱 하나의 목록 -->
    <div id="reviewList">
        {% for review in reviews %}
            <div class="review-item"
                 data-search="{{ review.title }} {{ review.author }} {{ review.content }} {{ review.get_category_display }}">
                <label>
                    <input type="checkbox" name="reviews" value="{{ review.id }}">
                    [{{ review.get_category_display }}] {{ review.title }}
                </label>
            </div>
        {% endfor %}
    </div>

    <br>
    <button type="submit">리스트 생성하기</button>

</form>

<!-- 검색 필터 JS -->
<script>
document.getElementById("reviewSearch").addEventListener("keyup", function () {
    let keyword = this.value.toLowerCase().trim();
    let items = document.querySelectorAll(".review-item");

    items.forEach(item => {
        let text = item.dataset.search.toLowerCase();
        // 검색어 없으면 전체 표시, 검색어 있으면 필터링
        if (keyword === "" || text.includes(keyword)) {
            item.style.display = "block";
        } else {
            item.style.display = "none";
        }
    });
});
</script>



{% endblock %}
